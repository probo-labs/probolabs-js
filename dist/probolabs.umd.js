!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ProboLabs={})}(this,(function(e){"use strict";const t={CLICKABLE:"CLICKABLE",FILLABLE:"FILLABLE",SELECTABLE:"SELECTABLE",NON_INTERACTIVE_ELEMENT:"NON_INTERACTIVE_ELEMENT"};class n{constructor(e,t,{tag:n,type:o,text:i,html:s,xpath:r,css_selector:l,bounding_box:c}){this.index=t.toString(),this.tag=n,this.type=o,this.text=i,this.html=s,this.xpath=r,this.css_selector=l,this.bounding_box=c,this.element=e,this.depth=-1}getSelector(){return this.xpath?this.xpath:this.css_selector}getDepth(){if(this.depth>=0)return this.depth;let e=0,t=this.element;for(;t&&t.nodeType===Node.ELEMENT_NODE;)e++,t=t.parentElement,t&&t.nodeType!==Node.ELEMENT_NODE&&t.getRootNode()instanceof ShadowRoot&&(t=t.getRootNode().host);return this.depth=e,this.depth}}function o(e){const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.children).forEach((function e(t){const n=new Set(["role","type","class","href","alt","title","readonly","checked","enabled","disabled"]);[...t.attributes].forEach((e=>{const o=e.name.toLowerCase(),i=e.value,s=/^(testid|test-id|data-test-id)$/.test(o),r=o.startsWith("data-")&&i,l=["readonly","checked","enabled","disabled"].includes(o);n.has(o)||r||s||l||t.removeAttribute(o)})),"svg"===t.tagName.toLowerCase()?([...t.attributes].forEach((e=>{const n=e.name.toLowerCase();"class"!==n&&"role"!==n&&t.removeAttribute(n)})),t.innerHTML="CONTENT REMOVED"):Array.from(t.children).forEach(e),["i","span","svg","button","input"].includes(t.tagName.toLowerCase())||t.children.length||t.textContent.trim()||t.remove()})),t.body.innerHTML}function i(e,t){const i=function(e){if(!e||e.getRootNode()instanceof ShadowRoot)return"";if(e.id)return`//*[@id="${e.id}"]`;const t=[];let n=e;for(;n&&n.nodeType===Node.ELEMENT_NODE;){let e=1,o=n.previousSibling;for(;o;)o.nodeType===Node.ELEMENT_NODE&&o.tagName===n.tagName&&e++,o=o.previousSibling;const i=n.tagName.toLowerCase();t.unshift(`${i}[${e}]`),n=n.parentNode}return"/"+t.join("/")}(e),s=function(e){const t=[];for(;e.nodeType===Node.ELEMENT_NODE;){let n=e.nodeName.toLowerCase(),o=e,i=1;for(;o=o.previousElementSibling;)o.nodeName.toLowerCase()===n&&i++;o=e;let s=!0;for(;o=o.nextElementSibling;)if(o.nodeName.toLowerCase()===n){s=!1;break}(i>1||!s)&&(n+=`:nth-of-type(${i})`),t.unshift(n),e.assignedSlot?e=e.assignedSlot:(e=e.parentNode).nodeType!==Node.ELEMENT_NODE&&e.getRootNode()instanceof ShadowRoot&&(e=e.getRootNode().host)}return t.join(" > ")}(e);return new n(e,t,{tag:e.tagName.toLowerCase(),type:e.type||"",text:function(e){const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let n,o="";for(;n=t.nextNode();){const e=n.textContent.trim();e&&(o&&(o+=" "),o+=e)}return o}(e),html:o(e.outerHTML),xpath:i,css_selector:s,bounding_box:e.getBoundingClientRect()})}const s=e=>{const t=e.bounding_box,n=t.width>0&&t.height>0,o=window.getComputedStyle(e.element),i="none"!==o.display&&"hidden"!==o.visibility;return!(!n||!i)};function r(e){const t=new Set;console.log(`Starting uniquification with ${e.length} elements`);const n=e.filter(s);n.sort(((e,t)=>e.getDepth()-t.getDepth())),console.log(`After dimension filtering: ${n.length} elements remain (${e.length-n.length} removed)`),n.forEach((e=>t.add(e.css_selector))),n.forEach((e=>{}));const o=n.filter((e=>{const n=function(e,t){const n=t.css_selector.split(" > ");for(let t=n.length-1;t>0;t--){const o=n.slice(0,t).join(" > ");if(e.has(o))return o}return null}(t,e),o=null==n||function(e,t){let n=!1;if("input"===e.tag&&("checkbox"===e.type||"radio"===e.type)){if("label"===t.tagName.toLowerCase())return!1}(function(e){return/^(input|select|textarea|button)$/i.test(e.tag)}(e)||c(e))&&(n=!0);return n}(e,n);return o}));console.log(`After parent/child filtering: ${o.length} elements remain (${n.length-o.length} removed)`);const i=o.filter((e=>!o.some((t=>!(o.indexOf(t)>=o.indexOf(e))&&l(e,t)))));return console.log(`Final elements after filtering: ${i.length} (${o.length-i.length} removed by overlap)`),i}const l=(e,t)=>{if(e.css_selector===t.css_selector)return!0;const n=e.bounding_box,o=t.bounding_box;return n.x===o.x&&n.y===o.y&&n.width===o.width&&n.height===o.height};const c=e=>{const t=e.element.className&&[/dropdown[-_]?item/i,/menu[-_]?item/i,/dropdown[-_]?link/i,/list[-_]?item/i,/select[-_]?item/i].some((t=>t.test(e.element.className))),n=e.element.getAttribute("role")&&[/menu[-_]?item/i,/option/i,/list[-_]?item/i,/tree[-_]?item/i].some((t=>t.test(e.element.getAttribute("role"))));return t||n};function a(e,t=document){const n=Array.from(t.querySelectorAll(e));return t.querySelectorAll("*").forEach((t=>{t.shadowRoot&&n.push(...a(e,t.shadowRoot))})),n}function u(){const e=[];e.push(...a("select")),e.push(...a('[role="combobox"], [role="listbox"], [role="dropdown"]'));const t=/.*(dropdown|select|combobox).*/i,n=a("*"),o=Array.from(n).filter((e=>{const n=t.test(e.className),o=["li","ul","span","div","p"].includes(e.tagName.toLowerCase());return n&&o}));return e.push(...o),e.push(...a('[aria-haspopup="true"], [aria-haspopup="listbox"]')),e.push(...a("nav ul li")),e}function d(){const e=[],t=[...a("a[href]")],n=[...a("button")],o=[...a('input[type="button"], input[type="submit"], input[type="reset"]')],i=[...a('[role="button"]')],s=[...a('[tabindex="0"]')],r=[...a("[onclick]")],l=u(),c=[...a('input[type="checkbox"]')],d=[...a('input[type="radio"]')],p=h(),g=function(){const e=[],t=a("*");return console.log("Checking elements with pointer style..."),t.forEach((t=>{if(t instanceof SVGElement)return;"pointer"===window.getComputedStyle(t).cursor&&e.push(t)})),console.log(`Found ${e.length} elements with pointer cursor`),e}();return e.push(...t,...n,...o,...i,...s,...r,...l,...c,...d,...p,...g),e}function h(){const e=[],t=a('input[type="checkbox"]'),n=/switch|toggle|slider/i;return t.forEach((t=>{let o=!1;if((n.test(t.className)||n.test(t.getAttribute("role")||""))&&(o=!0),!o){let e=t;for(let t=0;t<3;t++){const t=e.parentElement;if(!t)break;const i=t.className||"",s=t.getAttribute("role")||"";if(n.test(i)||n.test(s)){o=!0;break}e=t}}if(!o){const e=t.nextElementSibling;if(e){const t=e.className||"",i=e.getAttribute("role")||"";(n.test(t)||n.test(i))&&(o=!0)}}o&&e.push(t)})),e}const p={execute:async function(e){const t=await m(e);return f(t),t},unexecute:function(){const e=document.getElementById("highlight-overlay");e&&e.remove()},getElementInfo:i};function g(){const e=document.getElementById("highlight-overlay");e&&e.remove()}async function m(e){const n=Array.isArray(e)?e:[e];console.log("Starting element search for types:",n);const o=[];n.forEach((e=>{if(e===t.FILLABLE){const e=[...document.querySelectorAll('input:not([type="radio"]):not([type="checkbox"])')];console.log("Found inputs:",e.length,e),o.push(...e);const t=[...document.querySelectorAll("textarea")];console.log("Found textareas:",t.length),o.push(...t);const n=[...document.querySelectorAll('[contenteditable="true"]')];console.log("Found editables:",n.length),o.push(...n)}e===t.SELECTABLE&&o.push(...u()),e===t.CLICKABLE&&(o.push(...d()),o.push(...h()),o.push(...document.querySelectorAll('input[type="checkbox"]')),o.push(...document.querySelectorAll('input[type="radio"]'))),e===t.NON_INTERACTIVE_ELEMENT&&o.push(...Array.from(a("*")).filter((e=>{if(!e.firstElementChild){const t=e.tagName.toLowerCase();if(!["select","button","a"].includes(t))return["p","span","div","input","textarea"].includes(t)||/^h\d$/.test(t)}return!1})))}));const s=r(o.map(((e,t)=>i(e,t))));return console.log(`Found ${s.length} elements:`),s.forEach((e=>{console.log(`Element ${e.index}:`,e)})),s}function f(e){let t=document.getElementById("highlight-overlay");t||(t=document.createElement("div"),t.id="highlight-overlay",t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: 10000;\n    ",document.body.appendChild(t));const n=()=>{t.innerHTML="",e.forEach((e=>{let n=e.element;if(!n&&(n=(e=>{let t;return e.xpath?(t=document.evaluate(e.xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,t||console.warn("Failed to find element with xpath:",e.xpath)):(t=document.querySelector(e.css_selector),t||console.warn("Failed to find element with CSS selector:",e.css_selector)),t})(e),!n))return;const o=n.getBoundingClientRect();if(0===o.width||0===o.height)return void console.warn("Element has zero dimensions:",e);const i=document.createElement("div");i.style.cssText=`\n        position: fixed;\n        left: ${o.x}px;\n        top: ${o.y}px;\n        width: ${o.width}px;\n        height: ${o.height}px;\n        border: 1px solid rgb(255, 0, 0);\n        transition: all 0.2s ease-in-out;\n      `;const s=document.createElement("div");s.style.cssText="\n        position: absolute;\n        right: -10px;     /* Offset to the right */\n        top: -10px;       /* Offset upwards */\n        padding: 4px;\n        background-color: rgba(255, 255, 0, 0.6);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      ";const r=document.createElement("span");r.style.cssText="\n        color: rgb(0, 0, 0, 0.8);\n        font-family: 'Courier New', Courier, monospace;\n        font-size: 12px;\n        font-weight: bold;\n        line-height: 1;\n      ",r.textContent=e.index,s.appendChild(r),i.appendChild(s),t.appendChild(i)}))};n();const o=()=>{requestAnimationFrame(n)};window.addEventListener("scroll",o,!0),window.addEventListener("resize",n),t.scrollHandler=o,t.updateHighlights=n}"undefined"!=typeof window&&(window.ProboLabs={ElementTag:t,highlight:p,unhighlightElements:g,findElements:m,highlightElements:f}),e.findElements=m,e.highlight=p,e.highlightElements=f,e.unhighlightElements=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=probolabs.umd.js.map
